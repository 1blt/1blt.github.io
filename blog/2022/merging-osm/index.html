<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Merging OSM Files | Alan Wang, Ph.D. </title> <meta name="author" content="Alan Wang, Ph.D."> <meta name="description" content="Merging states for more accurate routing calculations"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?6c00a6d68591d0f04a26cd97dabff7f6"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://https//1blt.github.io//blog/2022/merging-osm/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Alan</span> Wang, Ph.D. </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Merging OSM Files</h1> <p class="post-meta"> Created on June 23, 2022 </p> <p class="post-tags"> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/code"> <i class="fa-solid fa-hashtag fa-sm"></i> code</a>   <a href="/blog/tag/data"> <i class="fa-solid fa-hashtag fa-sm"></i> data</a>   <a href="/blog/tag/geo"> <i class="fa-solid fa-hashtag fa-sm"></i> geo</a>   <a href="/blog/tag/mac"> <i class="fa-solid fa-hashtag fa-sm"></i> mac</a>   <a href="/blog/tag/docker"> <i class="fa-solid fa-hashtag fa-sm"></i> docker</a>   ·   <a href="/blog/category/research-log"> <i class="fa-solid fa-tag fa-sm"></i> research-log</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>This post investigates discrepancies in routing distances using multiple geospatial data sources, including Google Maps, and a custom merged OpenStreetMap file. It highlights anomalies in travel time calculations caused by inaccurate snapping and explores methods to resolve them. The detailed results are organized below in expandable sections for clarity and comparison.</p> <style>.expand-collapse-btn{padding:8px 16px;margin:.25em .5em 1em 0;font-size:.95rem;font-weight:500;color:#fff;background-color:#007acc;border:0;border-radius:6px;cursor:pointer;box-shadow:0 2px 5px rgba(0,0,0,0.1);transition:background-color .2s ease}.expand-collapse-btn:hover{background-color:#005fa3}</style> <p><button id="expand-all" class="expand-collapse-btn">Expand All</button> <button id="collapse-all" class="expand-collapse-btn">Collapse All</button></p> <details> <summary><strong>June 23, Thursday:</strong> Satisfactory result from testing</summary> <div> <ul> <li>I came back and found out that the process ran successfully.</li> <li>I went ahead and completed the ‘‘set-up” and went forward with the testing.</li> <li>The results show that the merged file has a <code class="language-plaintext highlighter-rouge">82%</code> match with the OSRM base server</li> </ul> </div> </details> <hr> <details> <summary><strong>June 22, Wednesday:</strong> Further investigating the OSRM queries</summary> <div> <ul> <li>I took a look at the OSRM query, and found some <a href="https://stackoverflow.com/questions/48221046/osrm-giving-wrong-response-for-distance-between-2-points" rel="external nofollow noopener" target="_blank">stackoverflow responses</a>. Specifically, <ul> <li>Do a manual sanity check about the route <a href="http://map.project-osrm.org/" rel="external nofollow noopener" target="_blank">here</a> </li> <li>Then cross reference whether the reference check would like like <a href="https://router.project-osrm.org/route/v1/driving/-78.8688833,38.4493315;-82.1885009,36.5959685" rel="external nofollow noopener" target="_blank">this</a>. Essentially, the coordinates should be supplied in lon lat format instead of lat lon</li> <li>Instead of root mean square error, I felt that using mean absolute difference made some more sense when reporting the individual elements as well as the collective error</li> </ul> </li> <li> <p>I then got the credentials for the digital ocean server on which I could run the OSRM things. The server runs pretty fast. I used <code class="language-plaintext highlighter-rouge">scp</code> to copy the pbf file onto the server to initialize the extraction. Since one of the operations took a long time, I looked to see if I can run something in the background and tackle it tomorrow when I came back. I found:</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nb">nohup </span>long-running-process &amp; <span class="nb">exit</span>
<span class="c"># To look up after you come back</span>
<span class="nb">tail</span> <span class="nt">-f</span> nohup.out
</code></pre></div> </div> </li> </ul> </div> </details> <hr> <details> <summary><strong>June 16, Thursday:</strong> Testing against the custom OSRM server</summary> <div> <ul> <li>The last part of the works I think should be finding the ability to query the docker server and cross compare the results. Looking at <a href="https://docs.docker.com/desktop/mac/networking/" rel="external nofollow noopener" target="_blank">Networking for Docker on MacOS</a>.</li> <li>Success. When running docker’s publish flag, the first argument is the host, and the next argument is the port on the container. ``To clarify the syntax, the following two commands both expose port 80 on the container to port 8000 on the host:” <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  docker run <span class="nt">--publish</span> 8000:80 <span class="nt">--name</span> webserver nginx
  docker run <span class="nt">-p</span> 8000:80 <span class="nt">--name</span> webserver nginx
</code></pre></div> </div> </li> <li>I’ve finished testing to a point. When I used the actual responses, none of the responses matched. If I use the route 0 distance, we actually get about 60 to 80 \% matches, but only on distances that were 0.</li> </ul> <p>In any case, I compiled an excel sheet with the query, response, city coordinates.</p> </div> </details> <hr> <details> <summary><strong>June 15, Wednesday:</strong> Ground truth for merged OSM File</summary> <div> <ul> <li> <p>Looked into an error ``/data/.osrm.ebg” not found!” and realized that you need to give a docker instance more memory in order to run the compilation. Therefore, I added 50g to the memory of the docker run in order to run the extraction.</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--memory</span><span class="o">=</span>50g <span class="nt">-t</span> <span class="nt">-v</span> <span class="s2">"</span><span class="k">${</span><span class="nv">PWD</span><span class="k">}</span><span class="s2">:/data"</span> osrm/osrm-backend osrm-extract <span class="nt">-p</span>  /opt/car.lua /data/merged.osm.pbf
</code></pre></div> </div> </li> <li> <p>This still did not work, so looking for an alternative solution. I will first try just rendering it for a single state, and see what the final completed ending messages are:</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="o">[</span>info] Writing edge-based-graph edges       ... 
<span class="o">[</span>info] ok, after 31.9418s
<span class="o">[</span>info] Processed 7687138 edges
<span class="o">[</span>info] Expansion: 26098 nodes/sec and 8605 edges/sec
<span class="o">[</span>info] To prepare the data <span class="k">for </span>routing, run: ./osrm-contract <span class="s2">"/data/virginia-latest.osrm"</span>
<span class="o">[</span>info] RAM: peak bytes used: 3638427648
</code></pre></div> </div> </li> <li>Response from the state of Virginia <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c"># curl "http://127.0.0.1:5000/route/v1/driving/38.9072,77.0369;36.7783,119.4179?annotations=distance"</span>
<span class="o">{</span><span class="s2">"message"</span>:<span class="s2">"Invalid coordinate value."</span>,<span class="s2">"code"</span>:<span class="s2">"InvalidValue"</span><span class="o">}</span><span class="c"># curl "http://127.0.0.1:5000/route/v1/driving/38.894500,77.070400;38.897700,77.036500?annotations=distance"</span>
<span class="o">{</span><span class="s2">"code"</span>:<span class="s2">"Ok"</span>,<span class="s2">"routes"</span>:[<span class="o">{</span><span class="s2">"geometry"</span>:<span class="s2">"w|</span><span class="sb">`</span>hFp<span class="o">{</span>viM??<span class="s2">","</span>legs<span class="s2">":[{"</span>annotation<span class="s2">":{"</span>distance<span class="s2">":[0]},"</span>steps<span class="s2">":[],"</span>distance<span class="s2">":0,"</span>duration<span class="s2">":0,"</span>summary<span class="s2">":"","</span>weight<span class="s2">":0}],"</span>distance<span class="s2">":0,"</span>duration<span class="s2">":0,"</span>weight_name<span class="s2">":"</span>routability<span class="s2">","</span>weight<span class="s2">":0}],"</span>waypoints<span class="s2">":[{"</span>hint<span class="s2">":"</span>zXQfgM90H4AAAAAAHAEAAAAAAABPDAEAAAAAANNqnUIAAAAACdiURgAAAAAcAQAAAAAAAE8MAQAYAwAAJCKF-5ymRgKke1ECQACYBAAALw3q5C0b<span class="s2">","</span>distance<span class="s2">":8074707.069774,"</span>name<span class="s2">":"","</span>location<span class="s2">":[-75.161052,38.184604]},{"</span>hint<span class="s2">":"</span>zXQfgM90H4AAAAAAHAEAAAAAAABPDAEAAAAAANNqnUIAAAAACdiURgAAAAAcAQAAAAAAAE8MAQAYAwAAJCKF-5ymRgIkiFEC1HuXBAAALw3q5C0b<span class="s2">","</span>distance<span class="s2">":8072844.13171,"</span>name<span class="s2">":"","</span>location<span class="s2">":[-75.161052,38.184604]}]}# curl "</span>http://127.0.0.1:5000/route/v1/driving/38.8945,77.0704<span class="p">;</span>40.4406,79.9959?annotations<span class="o">=</span>distance<span class="s2">"
{"</span>code<span class="s2">":"</span>Ok<span class="s2">","</span>routes<span class="s2">":[{"</span>geometry<span class="s2">":"</span>w|<span class="sb">`</span><span class="s2">hFp{viM??"</span>,<span class="s2">"legs"</span>:[<span class="o">{</span><span class="s2">"annotation"</span>:<span class="o">{</span><span class="s2">"distance"</span>:[0]<span class="o">}</span>,<span class="s2">"steps"</span>:[],<span class="s2">"distance"</span>:0,<span class="s2">"duration"</span>:0,<span class="s2">"summary"</span>:<span class="s2">""</span>,<span class="s2">"weight"</span>:0<span class="o">}]</span>,<span class="s2">"distance"</span>:0,<span class="s2">"duration"</span>:0,<span class="s2">"weight_name"</span>:<span class="s2">"routability"</span>,<span class="s2">"weight"</span>:0<span class="o">}]</span>,<span class="s2">"waypoints"</span>:[<span class="o">{</span><span class="s2">"hint"</span>:<span class="s2">"zXQfgM90H4AAAAAAHAEAAAAAAABPDAEAAAAAANNqnUIAAAAACdiURgAAAAAcAQAAAAAAAE8MAQAYAwAAJCKF-5ymRgKke1ECQACYBAAALw3q5C0b"</span>,<span class="s2">"distance"</span>:8074707.069774,<span class="s2">"name"</span>:<span class="s2">""</span>,<span class="s2">"location"</span>:[-75.161052,38.184604]<span class="o">}</span>,<span class="o">{</span><span class="s2">"hint"</span>:<span class="s2">"zXQfgM90H4AAAAAAHAEAAAAAAABPDAEAAAAAANNqnUIAAAAACdiURgAAAAAcAQAAAAAAAE8MAQAYAwAAJCKF-5ymRgIYE2kC_KPEBAAALw3q5C0b"</span>,<span class="s2">"distance"</span>:8102575.604085,<span class="s2">"name"</span>:<span class="s2">""</span>,<span class="s2">"location"</span>:[-75.161052,38.184604]<span class="o">}]}</span>
</code></pre></div> </div> </li> <li>Response from Virignia + West Virginia <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c"># curl "http://127.0.0.1:5000/route/v1/driving/38.9072,77.0369;36.7783,119.4179?annotations=distance"</span>
<span class="o">{</span><span class="s2">"message"</span>:<span class="s2">"Invalid coordinate value."</span>,<span class="s2">"code"</span>:<span class="s2">"InvalidValue"</span><span class="o">}</span><span class="c"># curl "http://127.0.0.1:5000/route/v1/driving/38.894500,77.070400;38.897700,77.036500?annotations=distance"</span>
<span class="o">{</span><span class="s2">"code"</span>:<span class="s2">"Ok"</span>,<span class="s2">"routes"</span>:[<span class="o">{</span><span class="s2">"geometry"</span>:<span class="s2">"w|</span><span class="sb">`</span>hFp<span class="o">{</span>viM??<span class="s2">","</span>legs<span class="s2">":[{"</span>annotation<span class="s2">":{"</span>distance<span class="s2">":[0]},"</span>steps<span class="s2">":[],"</span>distance<span class="s2">":0,"</span>duration<span class="s2">":0,"</span>summary<span class="s2">":"","</span>weight<span class="s2">":0}],"</span>distance<span class="s2">":0,"</span>duration<span class="s2">":0,"</span>weight_name<span class="s2">":"</span>routability<span class="s2">","</span>weight<span class="s2">":0}],"</span>waypoints<span class="s2">":[{"</span>hint<span class="s2">":"</span>_LwGgP68BoAAAAAAHAEAAAAAAABPDAEAAAAAANNqnUIAAAAACdiURgAAAAAcAQAAAAAAAE8MAQB5AwAAJCKF-5ymRgKke1ECQACYBAAALw0nEIeN<span class="s2">","</span>distance<span class="s2">":8074707.069774,"</span>name<span class="s2">":"","</span>location<span class="s2">":[-75.161052,38.184604]},{"</span>hint<span class="s2">":"</span>_LwGgP68BoAAAAAAHAEAAAAAAABPDAEAAAAAANNqnUIAAAAACdiURgAAAAAcAQAAAAAAAE8MAQB5AwAAJCKF-5ymRgIkiFEC1HuXBAAALw0nEIeN<span class="s2">","</span>distance<span class="s2">":8072844.13171,"</span>name<span class="s2">":"","</span>location<span class="s2">":[-75.161052,38.184604]}]}# curl "</span>http://127.0.0.1:5000/route/v1/driving/38.8945,77.0704<span class="p">;</span>40.4406,79.9959?annotations<span class="o">=</span>distance<span class="s2">"
{"</span>code<span class="s2">":"</span>Ok<span class="s2">","</span>routes<span class="s2">":[{"</span>geometry<span class="s2">":"</span>w|<span class="sb">`</span><span class="s2">hFp{viM??"</span>,<span class="s2">"legs"</span>:[<span class="o">{</span><span class="s2">"annotation"</span>:<span class="o">{</span><span class="s2">"distance"</span>:[0]<span class="o">}</span>,<span class="s2">"steps"</span>:[],<span class="s2">"distance"</span>:0,<span class="s2">"duration"</span>:0,<span class="s2">"summary"</span>:<span class="s2">""</span>,<span class="s2">"weight"</span>:0<span class="o">}]</span>,<span class="s2">"distance"</span>:0,<span class="s2">"duration"</span>:0,<span class="s2">"weight_name"</span>:<span class="s2">"routability"</span>,<span class="s2">"weight"</span>:0<span class="o">}]</span>,<span class="s2">"waypoints"</span>:[<span class="o">{</span><span class="s2">"hint"</span>:<span class="s2">"_LwGgP68BoAAAAAAHAEAAAAAAABPDAEAAAAAANNqnUIAAAAACdiURgAAAAAcAQAAAAAAAE8MAQB5AwAAJCKF-5ymRgKke1ECQACYBAAALw0nEIeN"</span>,<span class="s2">"distance"</span>:8074707.069774,<span class="s2">"name"</span>:<span class="s2">""</span>,<span class="s2">"location"</span>:[-75.161052,38.184604]<span class="o">}</span>,<span class="o">{</span><span class="s2">"hint"</span>:<span class="s2">"_LwGgP68BoAAAAAAHAEAAAAAAABPDAEAAAAAANNqnUIAAAAACdiURgAAAAAcAQAAAAAAAE8MAQB5AwAAJCKF-5ymRgIYE2kC_KPEBAAALw0nEIeN"</span>,<span class="s2">"distance"</span>:8102575.604085,<span class="s2">"name"</span>:<span class="s2">""</span>,<span class="s2">"location"</span>:[-75.161052,38.184604]<span class="o">}]}</span><span class="c"># </span>
</code></pre></div> </div> </li> <li> <p>It looks like the proper location in the response to extract the distances are based off of the legs instead of the way points. But also, the extracted file from Osmium seems to be working correctly. At least for Virginia + West Virginia.</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c">#curl "http://127.0.0.1:5000/route/v1/driving/37.630212545662474,-77.38546027847718;38.694396643163486,-79.9854414837675?annotations=distance"</span>

ce<span class="s2">":[0]},"</span>steps<span class="s2">":[],"</span>distance<span class="s2">":0,"</span>duration<span class="s2">":0,"</span>summary<span class="s2">":"","</span>weight<span class="s2">":0}],"</span>distance<span class="s2">":0,"</span>duration<span class="s2">":0,"</span>weight_name<span class="s2">":"</span>routability<span class="s2">","</span>weight<span class="s2">":0}],"</span>waypoints<span class="s2">":[{"</span>hint<span class="s2">":"</span>o0EFgKRBBYAAAAAAFAAAAAAAAACCCAAAAAAAAGGfXEEAAAAATLm8RAAAAAAUAAAAAAAAAIIIAAAkBQCABXB5-0iCLQIFMT4CDDFj-wAAPwAnEIeN<span class="s2">","</span>distance<span class="s2">":17306391.47749,"</span>name<span class="s2">":"</span>Knotts Island Road<span class="s2">","</span>location<span class="s2">":[-75.927547,36.536904]},{"</span>hint<span class="s2">":"</span>o0EFgKRBBYAAAAAAFAAAAAAAAACCCAAAAAAAAGGfXEEAAAAATLm8RAAAAAAUAAAAAAAAAIIIAAAkBQCABXB5-0iCLQL9bU4C34Q7-wAAPwAnEIeN<span class="s2">","</span>distance<span class="s2">":17523813.71623,"</span>name<span class="s2">":"</span>Knotts Island Road<span class="s2">","</span>location<span class="s2">":[-75.927547,36.536904]}]}
</span></code></pre></div> </div> </li> <li>The answers are still zero? Which doesn’t make sense. The kill all solution is probably to generate a list of random coordinates and cross-check that the return from the docker instance is same as the osm server.</li> <li>I put together a <a href="https://github.com/1blt-archive/dspg22_osm-tester" rel="external nofollow noopener" target="_blank">tester repository</a> for posterity.</li> </ul> </div> </details> <hr> <details> <summary><strong>June 14, Tuesday:</strong> Constructing test cases for OSM files</summary> <div> <ul> <li>Looking at how to <a href="https://docs.osmcode.org/osmium/latest/osmium-merge.html" rel="external nofollow noopener" target="_blank">merge</a> different states. Found the following command in Osmium <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  osmium merge file1.osm file2.osm <span class="nt">-o</span> merged.osm
</code></pre></div> </div> </li> <li> <p>I used the above command to combine the following files: District of Columbia, Pennsylvania, Virginia, and West Virginia and it seemed to work well. Tested this system on Docker, and storing a <a href="https://gist.github.com/1blt-archive/859cefaea7b61046d084ead1b3d104a1" rel="external nofollow noopener" target="_blank">gist</a> for future users. Note: it takes about half a day to a whole day just to compile the combined files for the osrm-partition and osrm-customize.</p> </li> <li>Got in, but running it now gives me errors: <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  qemu: uncaught target signal 11 <span class="o">(</span>Segmentation fault<span class="o">)</span> - core dumped
</code></pre></div> </div> </li> <li> <p>Based on the <a href="http://project-osrm.org/docs/v5.5.1/api/#routeleg-object" rel="external nofollow noopener" target="_blank">OSRM API Documentation</a>, the returned distances is in meters.</p> <table> <thead> <tr> <th>#</th> <th>Source</th> <th>From (Lat, Lon)</th> <th>To (Lat, Lon)</th> <th>Distance (m)</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Google Maps</td> <td>38.9072° N, 77.0369° W</td> <td>36.7783° N, 119.4179° W</td> <td>4,494,898</td> </tr> <tr> <td>2</td> <td>Germany OSM</td> <td>38.9072° N, 77.0369° W</td> <td>36.7783° N, 119.4179° W</td> <td>InvalidValue</td> </tr> <tr> <td>3</td> <td>Merged OSM</td> <td>38.9072° N, 77.0369° W</td> <td>36.7783° N, 119.4179° W</td> <td>(Seg Fault)</td> </tr> <tr> <td>4</td> <td>Google Maps</td> <td>38.8945° N, 77.0704° W</td> <td>38.8977° N, 77.0365° W</td> <td>4,345</td> </tr> <tr> <td>5</td> <td>Germany OSM</td> <td>38.8945° N, 77.0704° W</td> <td>38.8977° N, 77.0365° W</td> <td>0</td> </tr> <tr> <td>6</td> <td>Google Maps</td> <td>38.8945° N, 77.0704° W</td> <td>40.4406° N, 79.9959° W</td> <td>392,680</td> </tr> <tr> <td>7</td> <td>Germany OSM</td> <td>38.8945° N, 77.0704° W</td> <td>40.4406° N, 79.9959° W</td> <td>0</td> </tr> <tr> <td>8</td> <td>Merged OSM</td> <td>38.8945° N, 77.0704° W</td> <td>40.4406° N, 79.9959° W</td> <td>0</td> </tr> </tbody> </table> </li> </ul> </div> </details> <hr> <details> <summary><strong>June 13, Monday:</strong> Docker OSRM setup and testing</summary> <div> <ul> <li>Looking for ORSM files to download → looking for what OSM and OSRM files are.</li> <li>In order to properly test that the goal is complete, I wanted and worked with the <a href="https://github.com/Project-OSRM/osrm-backend" rel="external nofollow noopener" target="_blank">osrm-backend repository</a>.</li> <li>I downloaded <a href="http://download.geofabrik.de/" rel="external nofollow noopener" target="_blank">North America</a> to start (11 GB, takes about 30 minutes).</li> <li>Also installed <a href="https://docs.docker.com/desktop/mac/install/" rel="external nofollow noopener" target="_blank">Docker</a>.</li> <li><strong>Checked out some logs. Apparently, OSRM can <a href="https://github.com/Project-OSRM/osrm-backend/issues/4489" rel="external nofollow noopener" target="_blank">return 0 if you are running multiple processes</a>. Also, it <a href="https://github.com/Project-OSRM/osrm-backend/issues/5111" rel="external nofollow noopener" target="_blank">returns null if no route between the two places exists</a>.</strong></li> <li> <p>Running <a href="https://github.com/Project-OSRM/osrm-backend" rel="external nofollow noopener" target="_blank">Docker commands</a> from Project-OSRM <code class="language-plaintext highlighter-rouge">osrm-backend</code>.</p> <div class="language-shell highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  curl <span class="s2">"http://127.0.0.1:5000/route/v1/driving/13.388860,52.517037;13.385983,52.496891?steps=true"</span>
</code></pre></div> </div> <ul> <li>Looked into port not available error → ran the command with port 5001.</li> <li>Got the following error: <div class="language-shell highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  curl: <span class="o">(</span>52<span class="o">)</span> Empty reply from server
</code></pre></div> </div> <p>Probably means it is not listening. Investigating different ways to start the Docker instance so that it can listen to curls.</p> </li> <li>Went inside the Docker instance, installed curl: <div class="language-shell highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  apt-get update<span class="p">;</span> apt-get <span class="nb">install </span>curl
</code></pre></div> </div> <p>Then ran the command and it returned a response (<code class="language-plaintext highlighter-rouge">logs/osrm-response-1</code>).</p> </li> <li> <p>Looked up the <code class="language-plaintext highlighter-rouge">-p</code> flag:</p> <div class="language-text highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  -p=[]      : Publish a container's port or a range of ports to the host
               format: ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort | containerPort
               ...
               (use 'docker port' to see the actual mapping)
</code></pre></div> </div> <p>Since it seems like the port can be flexible, the Docker runs the listener on port 5000:</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  curl <span class="s2">"http://127.0.0.1:5000/route/v1/driving/13.388860,52.517037;13.385983,52.496891?steps=true"</span>
</code></pre></div> </div> </li> </ul> </li> <li>Constructed a ground truth test for seeing if a route from <code class="language-plaintext highlighter-rouge">77.05472,38.90859</code> to <code class="language-plaintext highlighter-rouge">-75.37836,40.0806</code> would make sense. What happens when you query the server with two points that do not exist? Ran this on the Germany-based Docker: <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  curl <span class="s2">"http://127.0.0.1:5000/route/v1/driving/77.05472,38.90859;-77.069351,38.90346?steps=true"</span>
</code></pre></div> </div> </li> <li>Unsure what the response means. Planning to run the frontend and test routing between places with no data. <ul> <li>Access the <strong>Docker IP address</strong>, not the shown one inside (i.e., use <code class="language-plaintext highlighter-rouge">0.0.0.0:9966</code>, not <code class="language-plaintext highlighter-rouge">http://172.17.0.3:9966/</code>).</li> <li>Running the frontend takes a long time and does not load…</li> </ul> </li> <li> <p>Trying to ping a local URL to get the response data. You can get a response from Docker using:</p> <div class="language-shell highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  docker <span class="nb">exec</span> &lt;docker-id&gt; curl <span class="s2">"http://127.0.0.1:5000/route/v1/driving/77.05472,38.90859;-77.069351,38.90346?steps=true"</span>
</code></pre></div> </div> </li> <li>Coworker gave me a <a href="http://download.geofabrik.de/north-america/us.html" rel="external nofollow noopener" target="_blank">website</a> to download individual pieces for testing merge versions.</li> </ul> </div> </details> <hr> <details> <summary><strong>June 10th, Friday:</strong> OSM merge, routing issue investigation</summary> <div> <p>Explored merging <a href="https://www.openstreetmap.org/" rel="external nofollow noopener" target="_blank">OpenStreetMap (OSM)</a> files using Osmium to generate tri-state area maps and investigated routing anomalies caused by incorrect location snapping in OSRM.</p> <p><strong>Problem Statement</strong>: It looks like the routing machine is maybe snapping or something. For example, in one case, both locations resolve to a bridge at -77.069351, 38.903462, so the travel time is 0 minutes, which doesn’t happen on the <a href="https://router.project-osrm.org/table/v1/car/-77.05472,38.90859;-75.37836,40.08063" rel="external nofollow noopener" target="_blank">public router</a>. That’s happening for 19 other locations around that centroid (block group 110010001011 with a centroid of -77.05472, 38.90859).</p> <ul> <li>I found a tool online called <a href="https://github.com/osmcode/pyosmium/blob/master/README.md" rel="external nofollow noopener" target="_blank">Osmium</a>.</li> <li>PyOsmium was giving me some problems on install, so I used the <a href="https://formulae.brew.sh/formula/osmium-tool" rel="external nofollow noopener" target="_blank">Homebrew version</a> instead.</li> <li>I ran the following command:</li> </ul> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>osmium-tool
</code></pre></div> </div> </div> </details> <hr> <script>
  document.addEventListener("DOMContentLoaded", function () {
    const expandBtn = document.getElementById("expand-all");
    const collapseBtn = document.getElementById("collapse-all");
    const allDetails = document.querySelectorAll("details");

    if (expandBtn) {
      expandBtn.addEventListener("click", () => {
        allDetails.forEach(d => d.setAttribute("open", "true"));
      });
    }

    if (collapseBtn) {
      collapseBtn.addEventListener("click", () => {
        allDetails.forEach(d => d.removeAttribute("open"));
      });
    }
  });
</script> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/topojson/">Exploring and Splitting TopoJSONs</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/extracting-broadband-data/">Extracting Broadband Data in an IP-Throttled Web</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Alan Wang, Ph.D.. Last updated: June 01, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="/assets/js/mermaid-setup.js?38ca0a0126f7328d2d9a46bad640931f" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>